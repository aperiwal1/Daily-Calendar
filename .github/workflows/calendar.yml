name: Economic Calendar Bot

on:
  schedule:
    # Run at 21:55 UTC (4:45 PM ET standard time, 5:45 PM ET daylight saving)
    - cron: '45 21 * * 1-5'
  
  # Allow manual trigger for testing
  workflow_dispatch:

jobs:
  post-calendar:
    runs-on: ubuntu-latest
    
    steps:
      - name: Log current time (UTC & New York)
        run: |
          echo "UTC now:      $(date -u '+%Y-%m-%d %H:%M:%S %Z')"
          echo "New York now: $(TZ='America/New_York' date '+%Y-%m-%d %H:%M:%S %Z')"

      - name: Set New York date env
        run: echo "DATE_NY=$(TZ='America/New_York' date +%Y-%m-%d)" >> $GITHUB_ENV

      - name: Skip if weekend in New York
        run: |
          NY_DOW=$(TZ="America/New_York" date +'%u')
          echo "NY Day of Week: ${NY_DOW} (1=Mon, 7=Sun)"
          if [ "$NY_DOW" -gt 5 ]; then
            echo "Weekend — skipping."
            exit 0
          fi
          echo "Weekday — continuing."

      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Run Economic Calendar Bot
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: python economic_calendar_bot.py
